<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Data Visualization - Healthcare IoT</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
      padding: 0;
      margin: 0;
    }

    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      z-index: 2000;
      border-bottom: 1px solid rgba(0, 245, 255, 0.2);
      box-shadow: 0 2px 20px rgba(0, 245, 255, 0.2);
    }

    .top-nav-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notifications {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9999;
      max-width: 350px;
    }

    .notification {
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      color: white;
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 245, 255, 0.4);
      animation: slideIn 0.3s ease;
      border-left: 5px solid;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .notification.critical { border-left-color: #ff0066; background: rgba(255, 0, 102, 0.2); }
    .notification.warning { border-left-color: #ffb800; background: rgba(255, 184, 0, 0.2); }
    .notification.normal { border-left-color: #00ff87; background: rgba(0, 255, 135, 0.2); }

    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .nav-brand {
      font-size: 1.3em;
      font-weight: bold;
      color: #00f5ff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .nav-button {
      padding: 10px 20px;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 245, 255, 0.2);
      border-radius: 10px;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }
    
    .nav-button:hover {
      background: rgba(0, 245, 255, 0.2);
      border-color: #00f5ff;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 245, 255, 0.4);
    }

    .nav-button.active {
      background: rgba(0, 245, 255, 0.3);
      border-color: #00f5ff;
      box-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
    }

    #background-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    .content {
      position: relative;
      z-index: 1;
      padding: 20px;
      padding-top: 100px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 40px 20px;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      margin-bottom: 40px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .header h1 {
      font-size: 3.5em;
      margin-bottom: 15px;
      background: linear-gradient(45deg, #00f5ff, #0080ff, #ff00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 5s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { filter: hue-rotate(0deg); }
      50% { filter: hue-rotate(90deg); }
    }



    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .glass-card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(20px);
      padding: 12px;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 245, 255, 0.1) 0%, transparent 70%);
      animation: rotate 15s linear infinite;
      pointer-events: none;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .glass-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 60px rgba(0, 245, 255, 0.3);
      border-color: rgba(0, 245, 255, 0.5);
    }

    .card-content {
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 0.9em;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #00f5ff;
    }

    .metric-display {
      font-size: 2em;
      font-weight: bold;
      margin: 8px 0;
      text-align: center;
      background: linear-gradient(135deg, #00f5ff, #ff00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .metric-unit {
      font-size: 0.3em;
      color: rgba(255,255,255,0.6);
    }

    .status-indicator {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-optimal {
      background: rgba(0, 255, 135, 0.2);
      color: #00ff87;
      border: 1px solid #00ff87;
      box-shadow: 0 0 15px rgba(0, 255, 135, 0.4);
    }

    .status-warning {
      background: rgba(255, 184, 0, 0.2);
      color: #ffb800;
      border: 1px solid #ffb800;
      box-shadow: 0 0 15px rgba(255, 184, 0, 0.4);
    }

    .status-critical {
      background: rgba(255, 0, 102, 0.2);
      color: #ff0066;
      border: 1px solid #ff0066;
      box-shadow: 0 0 15px rgba(255, 0, 102, 0.4);
    }

    .chart-container {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(20px);
      padding: 5px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 5px;
    }

    .chart-title {
      font-size: 0.85em;
      margin-bottom: 3px;
      color: #00f5ff;
    }

    .pulse-animation {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }

    .data-stream {
      height: 200px;
      position: relative;
      overflow: hidden;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      margin-top: 20px;
    }

    .stream-line {
      position: absolute;
      height: 2px;
      width: 100%;
      background: linear-gradient(90deg, transparent, #00f5ff, transparent);
      animation: streamFlow 3s linear infinite;
    }

    @keyframes streamFlow {
      from { transform: translateY(-20px); }
      to { transform: translateY(220px); }
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 8px;
    }

    .info-item {
      background: rgba(255,255,255,0.05);
      padding: 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .info-label {
      font-size: 0.85em;
      color: rgba(255,255,255,0.6);
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1em;
      font-weight: 600;
      color: #00f5ff;
    }

    .realtime-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 15px;
      background: rgba(255, 0, 102, 0.2);
      border: 1px solid #ff0066;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      box-shadow: 0 0 15px rgba(255, 0, 102, 0.4);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: #ff0066;
      border-radius: 50%;
      animation: blink 1s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .visualization-container {
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(20px);
      padding: 5px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2em;
      }
      
      .metric-display {
        font-size: 2.5em;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <canvas id="background-canvas"></canvas>

  <nav class="top-nav">
    <div class="top-nav-content">
      <div class="nav-brand">üè• Healthcare IoT</div>
      <div class="nav-links">
        <a href="/index.html" class="nav-button">üè• Patient Monitor</a>
        <a href="/network.html" class="nav-button">üåê Network</a>
        <a href="/analytics.html" class="nav-button">üìà Analytics</a>
        <a href="/visualization.html" class="nav-button active">üåå 3D View</a>
      </div>
    </div>
  </nav>

  <div class="content">
    <div class="header">
      <h1>üåå 3D Data Visualization</h1>
      <p>Immersive Healthcare IoT Monitoring Experience</p>
      <div class="realtime-badge">
        <span class="live-dot"></span>
        <span>LIVE</span>
      </div>
    </div>

    <div class="dashboard-grid">
      <div class="glass-card pulse-animation">
        <div class="card-content">
          <div class="card-title">‚ù§Ô∏è Heart Rate</div>
          <div class="metric-display" id="hr3d">
            82<span class="metric-unit">bpm</span>
          </div>
          <div style="text-align: center;">
            <span class="status-indicator status-optimal" id="hrStatus">OPTIMAL</span>
          </div>
          <div class="data-stream">
            <div class="stream-line" style="animation-delay: 0s;"></div>
            <div class="stream-line" style="animation-delay: 1s;"></div>
            <div class="stream-line" style="animation-delay: 2s;"></div>
          </div>
        </div>
      </div>

      <div class="glass-card pulse-animation">
        <div class="card-content">
          <div class="card-title">üå°Ô∏è Temperature</div>
          <div class="metric-display" id="temp3d" style="animation-delay: 0.2s;">
            37.2<span class="metric-unit">¬∞C</span>
          </div>
          <div style="text-align: center;">
            <span class="status-indicator status-optimal" id="tempStatus">OPTIMAL</span>
          </div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Min Today</div>
              <div class="info-value">36.5¬∞C</div>
            </div>
            <div class="info-item">
              <div class="info-label">Max Today</div>
              <div class="info-value">37.8¬∞C</div>
            </div>
          </div>
        </div>
      </div>

      <div class="glass-card pulse-animation">
        <div class="card-content">
          <div class="card-title">üíß Blood Oxygen</div>
          <div class="metric-display" id="spo23d" style="animation-delay: 0.4s;">
            98<span class="metric-unit">%</span>
          </div>
          <div style="text-align: center;">
            <span class="status-indicator status-optimal" id="spo2Status">OPTIMAL</span>
          </div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Saturation</div>
              <div class="info-value">Excellent</div>
            </div>
            <div class="info-item">
              <div class="info-label">Trend</div>
              <div class="info-value">Stable</div>
            </div>
          </div>
        </div>
      </div>

      <div class="glass-card pulse-animation">
        <div class="card-content">
          <div class="card-title">üíâ Blood Pressure</div>
          <div class="metric-display" id="bp3d" style="animation-delay: 0.6s; font-size: 2.5em;">
            120/80<span class="metric-unit">mmHg</span>
          </div>
          <div style="text-align: center;">
            <span class="status-indicator status-optimal" id="bpStatus">OPTIMAL</span>
          </div>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Systolic</div>
              <div class="info-value" id="systolic">120</div>
            </div>
            <div class="info-item">
              <div class="info-label">Diastolic</div>
              <div class="info-value" id="diastolic">80</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <div class="chart-title">üìä Real-Time Vital Signs Monitor</div>
      <canvas id="waveformChart" height="15"></canvas>
    </div>

    <div class="visualization-container">
      <canvas id="particleCanvas" width="1200" height="50"></canvas>
    </div>
  </div>

  <script>
    // Three.js Background Animation
    const canvas = document.getElementById('background-canvas');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
    
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.position.z = 5;

    // Create particles
    const particlesGeometry = new THREE.BufferGeometry();
    const particlesCount = 1000;
    const posArray = new Float32Array(particlesCount * 3);

    for(let i = 0; i < particlesCount * 3; i++) {
      posArray[i] = (Math.random() - 0.5) * 10;
    }

    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    
    const particlesMaterial = new THREE.PointsMaterial({
      size: 0.008,
      color: 0x00f5ff,
      transparent: true,
      opacity: 0.9,
      sizeAttenuation: true
    });

    const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
    scene.add(particlesMesh);

    // FPS-limited Animation loop
    let lastTime = 0;
    const fps = 30;
    const interval = 1000 / fps;

    function animate(currentTime) {
      requestAnimationFrame(animate);
      
      const deltaTime = currentTime - lastTime;
      
      if (deltaTime > interval) {
        lastTime = currentTime - (deltaTime % interval);
        
        particlesMesh.rotation.x += 0.001;
        particlesMesh.rotation.y += 0.002;
        renderer.render(scene, camera);
      }
    }
    animate(0);

    // Optimized Resize handler with debouncing
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      }, 100);
    });

    // Waveform Chart
    const waveformCtx = document.getElementById('waveformChart').getContext('2d');
    let waveformData = Array(50).fill(0);
    let timeLabels = Array.from({length: 50}, (_, i) => i);

    const waveformChart = new Chart(waveformCtx, {
      type: 'line',
      data: {
        labels: timeLabels,
        datasets: [
          {
            label: 'Heart Rate',
            data: waveformData,
            borderColor: '#ff0066',
            backgroundColor: 'rgba(255, 0, 102, 0.1)',
            borderWidth: 3,
            tension: 0.4,
            fill: true,
            pointRadius: 0
          },
          {
            label: 'SpO2',
            data: waveformData.map(() => Math.random() * 10 + 95),
            borderColor: '#00f5ff',
            backgroundColor: 'rgba(0, 245, 255, 0.1)',
            borderWidth: 3,
            tension: 0.4,
            fill: true,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        plugins: {
          legend: {
            labels: { color: '#fff', font: { size: 14 } }
          }
        },
        scales: {
          x: {
            display: false
          },
          y: {
            ticks: { color: '#fff' },
            grid: { color: 'rgba(255,255,255,0.1)' }
          }
        }
      }
    });

    // Particle Canvas Animation
    const particleCanvas = document.getElementById('particleCanvas');
    const pCtx = particleCanvas.getContext('2d');
    const particles = [];

    class Particle {
      constructor() {
        this.x = Math.random() * particleCanvas.width;
        this.y = Math.random() * particleCanvas.height;
        this.size = Math.random() * 3 + 1;
        this.speedX = Math.random() * 2 - 1;
        this.speedY = Math.random() * 2 - 1;
        this.color = Math.random() > 0.5 ? '#00f5ff' : '#ff00ff';
      }

      update() {
        this.x += this.speedX;
        this.y += this.speedY;

        if (this.x > particleCanvas.width || this.x < 0) this.speedX *= -1;
        if (this.y > particleCanvas.height || this.y < 0) this.speedY *= -1;
      }

      draw() {
        pCtx.fillStyle = this.color;
        pCtx.beginPath();
        pCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        pCtx.fill();
      }
    }

    for (let i = 0; i < 50; i++) {
      particles.push(new Particle());
    }

    let lastParticleTime = 0;
    const particleFps = 30;
    const particleInterval = 1000 / particleFps;

    function animateParticles(currentTime) {
      requestAnimationFrame(animateParticles);
      
      const deltaTime = currentTime - lastParticleTime;
      
      if (deltaTime > particleInterval) {
        lastParticleTime = currentTime - (deltaTime % particleInterval);
        
        pCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
        pCtx.fillRect(0, 0, particleCanvas.width, particleCanvas.height);

        for (let i = 0; i < particles.length; i++) {
          particles[i].update();
          particles[i].draw();
        }

        const connectionDistance = 120;
        for (let i = 0; i < particles.length; i++) {
          let connectionsDrawn = 0;
          for (let j = i + 1; j < particles.length && connectionsDrawn < 3; j++) {
            const dx = particles[i].x - particles[j].x;
            const dy = particles[i].y - particles[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < connectionDistance) {
              pCtx.strokeStyle = `rgba(0, 245, 255, ${0.3 * (1 - distance / connectionDistance)})`;
              pCtx.lineWidth = 0.5;
              pCtx.beginPath();
              pCtx.moveTo(particles[i].x, particles[i].y);
              pCtx.lineTo(particles[j].x, particles[j].y);
              pCtx.stroke();
              connectionsDrawn++;
            }
          }
        }
      }
    }
    animateParticles(0);

    // Update vital signs
    function updateVitals() {
      const hr = Math.floor(Math.random() * 30) + 70;
      const temp = (Math.random() * 2 + 36.5).toFixed(1);
      const spo2 = Math.floor(Math.random() * 5) + 95;
      const bpSys = Math.floor(Math.random() * 30) + 110;
      const bpDia = Math.floor(Math.random() * 20) + 70;

      document.getElementById('hr3d').innerHTML = `${hr}<span class="metric-unit">bpm</span>`;
      document.getElementById('temp3d').innerHTML = `${temp}<span class="metric-unit">¬∞C</span>`;
      document.getElementById('spo23d').innerHTML = `${spo2}<span class="metric-unit">%</span>`;
      document.getElementById('bp3d').innerHTML = `${bpSys}/${bpDia}<span class="metric-unit">mmHg</span>`;
      document.getElementById('systolic').textContent = bpSys;
      document.getElementById('diastolic').textContent = bpDia;

      // Update statuses
      updateStatus('hrStatus', hr, 60, 100);
      updateStatus('tempStatus', parseFloat(temp), 36.5, 37.5);
      updateStatus('spo2Status', spo2, 95, 100);
      updateStatus('bpStatus', bpSys, 90, 140);

      // Update waveform
      waveformData.shift();
      waveformData.push(hr);
      waveformChart.data.datasets[0].data = waveformData;
      waveformChart.data.datasets[1].data = waveformData.map(() => Math.random() * 5 + 95);
      waveformChart.update();
    }

    function updateStatus(elementId, value, min, max) {
      const element = document.getElementById(elementId);
      if (value < min || value > max) {
        element.className = 'status-indicator status-warning';
        element.textContent = 'WARNING';
      } else {
        element.className = 'status-indicator status-optimal';
        element.textContent = 'OPTIMAL';
      }
    }

    // Update every 2 seconds
    setInterval(updateVitals, 2000);
    updateVitals();
  </script>
</body>
</html>
